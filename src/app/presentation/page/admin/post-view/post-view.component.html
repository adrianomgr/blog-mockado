<div class="post-management">
  <div class="page-header">
    <h1>Gerenciar Posts</h1>
    <p-button label="Novo Post" icon="pi pi-plus" (onClick)="showCreateDialog()"></p-button>
  </div>

  <p-card class="posts-table-card">
    <ng-template pTemplate="content">
      @if (loading) {
      <div class="loading-container">
        <i class="pi pi-spin pi-spinner loading-spinner"></i>
        <p>Carregando posts...</p>
      </div>
      } @else {
      <p-table
        [value]="posts"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} posts"
        [globalFilterFields]="['title', 'author', 'status']"
        #dt
      >
        <ng-template pTemplate="caption">
          <div class="table-header">
            <p-inputgroup>
              <p-inputgroup-addon>
                <i class="pi pi-search"></i>
              </p-inputgroup-addon>
              <input
                pInputText
                type="text"
                (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                placeholder="Buscar posts..."
              />
            </p-inputgroup>
          </div>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th scope="col">Título</th>
            <th scope="col">Autor</th>
            <th scope="col">Status</th>
            <th scope="col">Data</th>
            <th scope="col">Ações</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-post>
          <tr>
            <td>{{ post.title }}</td>
            <td>{{ post.author }}</td>
            <td>
              <p-tag
                [value]="post.status | postStatusLabel"
                [severity]="post.status | postStatusSeverity"
              ></p-tag>
            </td>
            <td>{{ post.createdAt | date : 'dd/MM/yyyy' }}</td>
            <td>
              <p-button
                icon="pi pi-pencil"
                severity="info"
                [text]="true"
                (onClick)="editPost(post)"
                pTooltip="Editar"
              ></p-button>
              <p-button
                icon="pi pi-trash"
                severity="danger"
                [text]="true"
                (onClick)="deletePost(post)"
                pTooltip="Deletar"
              ></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
      }
    </ng-template>
  </p-card>

  <p-dialog
    header="Gerenciar Post"
    [(visible)]="displayDialog"
    [modal]="true"
    [style]="{ width: '800px' }"
    [closable]="true"
  >
    <form [formGroup]="postForm" (ngSubmit)="savePost()">
      <div class="form-grid mt-4">
        <div class="form-field my-2">
          <p-floatlabel>
            <input id="title" type="text" pInputText formControlName="title" class="w-full" />
            <label for="title">Título *</label>
          </p-floatlabel>
        </div>

        <div class="field my-2">
          <p-floatlabel>
            <p-select
              id="status"
              formControlName="status"
              [options]="statusOptions"
              class="w-full"
            ></p-select>
            <label for="status">Status</label>
          </p-floatlabel>
        </div>

        <div class="form-field full-width my-2">
          <label for="content" class="block text-sm font-medium mb-2">Conteúdo *</label>
          <textarea
            id="content"
            formControlName="content"
            rows="10"
            class="w-full p-inputtext"
            placeholder="Digite o conteúdo do post..."
          >
          </textarea>
        </div>

        <div class="form-field full-width my-2">
          <label for="tags" class="block text-sm font-medium mb-2"
            >Tags (separadas por vírgula)</label
          >
          <input
            id="tags"
            type="text"
            pInputText
            formControlName="tags"
            class="w-full"
            placeholder="javascript, angular, typescript"
          />
        </div>
      </div>

      <div class="dialog-footer">
        <p-button label="Cancelar" severity="secondary" (onClick)="hideDialog()"></p-button>
        <p-button label="Salvar" type="submit" [disabled]="postForm.invalid"></p-button>
      </div>
    </form>
  </p-dialog>
</div>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
